<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATC TV Scheduler — Dashboard</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
</head>
<body>
    <header class="top-bar">
        <div class="brand">
            <h1>ATC <span class="accent">TV Scheduler</span></h1>
            <span class="subtitle">ATC</span>
        </div>
        <div class="top-bar-right">
            <div class="api-key-input">
                <input type="password" id="apiKeyInput" placeholder="API Key (if required)" autocomplete="off">
            </div>
            <div class="tv-status" id="tvStatus">
                <span class="dot" id="statusDot"></span>
                <span id="statusText">Checking…</span>
            </div>
        </div>
    </header>

    <main class="dashboard">
        <!-- Live TV Control Board -->
        <section class="card control-board" id="controlBoard">
            <div class="control-header">
                <div class="control-title">
                    <span class="live-indicator"></span>
                    <h2>LIVE TV MONITOR</h2>
                </div>
                <div class="control-meta">
                    <span class="muted" id="monitorRefresh">Auto-refresh: 60s</span>
                    <button class="btn btn-sm" id="refreshMonitor">Refresh Now</button>
                </div>
            </div>

            <div class="tv-monitors">
                <div class="tv-monitor" data-tv="1" data-board="mainboard">
                    <div class="tv-label">
                        <span class="tv-name">TV1 — MAINBOARD</span>
                        <span class="tv-location">Front of Gym</span>
                    </div>
                    <div class="tv-screen" id="tv1Screen">
                        <iframe src="/tv/mainboard" id="tv1Frame" sandbox="allow-same-origin"></iframe>
                    </div>
                    <div class="tv-info">
                        <span class="tv-status-dot" id="tv1Dot"></span>
                        <span class="tv-card-title" id="tv1Title">Loading...</span>
                        <span class="tv-card-meta" id="tv1Meta"></span>
                    </div>
                </div>

                <div class="tv-monitor" data-tv="2" data-board="modboard">
                    <div class="tv-label">
                        <span class="tv-name">TV2 — MODBOARD</span>
                        <span class="tv-location">Front of Gym</span>
                    </div>
                    <div class="tv-screen" id="tv2Screen">
                        <iframe src="/tv/modboard" id="tv2Frame" sandbox="allow-same-origin"></iframe>
                    </div>
                    <div class="tv-info">
                        <span class="tv-status-dot" id="tv2Dot"></span>
                        <span class="tv-card-title" id="tv2Title">Loading...</span>
                        <span class="tv-card-meta" id="tv2Meta"></span>
                    </div>
                </div>

                <div class="tv-monitor mirror" data-tv="3" data-board="mainboard">
                    <div class="tv-label">
                        <span class="tv-name">TV3 — MAINBOARD</span>
                        <span class="tv-location">Back of Gym</span>
                        <span class="mirror-badge">Mirrors TV1</span>
                    </div>
                    <div class="tv-screen" id="tv3Screen">
                        <iframe src="/tv/mainboard" id="tv3Frame" sandbox="allow-same-origin"></iframe>
                    </div>
                    <div class="tv-info">
                        <span class="tv-status-dot" id="tv3Dot"></span>
                        <span class="tv-card-title" id="tv3Title">Loading...</span>
                        <span class="tv-card-meta" id="tv3Meta"></span>
                    </div>
                </div>
            </div>

            <div class="swap-countdown">
                <span>Next card swap in: </span>
                <strong id="swapTimer">--</strong>
                <span class="muted"> (midnight CST)</span>
            </div>
        </section>

        <!-- Schedule Form -->
        <section class="card form-card">
            <h2>Push Schedule</h2>
            <form id="scheduleForm">
                <div class="form-row">
                    <label for="templatePicker">Load from Template</label>
                    <select id="templatePicker">
                        <option value="">— Select a template —</option>
                    </select>
                </div>
                <div class="form-row">
                    <label for="scheduleDate">Schedule Date</label>
                    <input type="date" id="scheduleDate" required>
                </div>
                <div class="form-row">
                    <label for="boardType">Board</label>
                    <select id="boardType" required>
                        <option value="mainboard">Mainboard (TV1 + TV3)</option>
                        <option value="modboard">Modboard (TV2)</option>
                    </select>
                </div>
                <div class="form-row">
                    <label for="workoutTitle">Workout Title</label>
                    <input type="text" id="workoutTitle" placeholder="e.g. CHEST & TRICEPS" required>
                </div>
                <div class="form-row">
                    <label for="workoutDateLabel">Date Label</label>
                    <input type="text" id="workoutDateLabel" placeholder="e.g. Monday — Feb 24, 2026">
                </div>
                <div class="form-row">
                    <label for="version">Version</label>
                    <select id="version">
                        <option value="rx">Rx (Default for Mainboard)</option>
                        <option value="scaled">Scaled</option>
                        <option value="mod">Mod (Default for Modboard)</option>
                    </select>
                </div>
                <div class="form-row">
                    <label for="htmlContent">Card HTML</label>
                    <textarea id="htmlContent" rows="8" placeholder="Paste rendered card HTML here…" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Push to Schedule</button>
                    <button type="button" class="btn btn-secondary" id="previewBtn">Preview</button>
                    <button type="button" class="btn btn-secondary" id="saveTemplateBtn">Save as Template</button>
                    <button type="reset" class="btn btn-secondary">Clear</button>
                </div>
            </form>
            <div id="formMessage" class="message hidden"></div>
        </section>

        <!-- Clone Panel -->
        <section class="card clone-card">
            <h2>Clone Schedule</h2>
            <p class="muted">Copy cards from one date to another, or clone an entire week.</p>

            <h3 class="section-label">Clone Day</h3>
            <form id="cloneDayForm">
                <div class="form-row">
                    <label for="cloneSourceDate">Source Date</label>
                    <input type="date" id="cloneSourceDate" required>
                </div>
                <div class="form-row">
                    <label for="cloneTargetDate">Target Date</label>
                    <input type="date" id="cloneTargetDate" required>
                </div>
                <div class="form-row">
                    <label for="cloneBoard">Board (optional)</label>
                    <select id="cloneBoard">
                        <option value="">Both boards</option>
                        <option value="mainboard">Mainboard only</option>
                        <option value="modboard">Modboard only</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Clone Day</button>
            </form>
            <div id="cloneDayMessage" class="message hidden"></div>

            <h3 class="section-label" style="margin-top:20px;">Clone Week</h3>
            <form id="cloneWeekForm">
                <div class="form-row">
                    <label for="cloneSourceWeek">Source Week (Monday)</label>
                    <input type="date" id="cloneSourceWeek" required>
                </div>
                <div class="form-row">
                    <label for="cloneTargetWeek">Target Week (Monday)</label>
                    <input type="date" id="cloneTargetWeek" required>
                </div>
                <button type="submit" class="btn btn-primary">Clone Week</button>
            </form>
            <div id="cloneWeekMessage" class="message hidden"></div>
        </section>

        <!-- Weekly Calendar -->
        <section class="card calendar-card">
            <h2>Schedule Overview</h2>
            <div class="calendar-controls">
                <button class="btn btn-sm" id="prevWeek">&larr; Prev</button>
                <span id="weekLabel">This Week</span>
                <button class="btn btn-sm" id="nextWeek">Next &rarr;</button>
            </div>
            <div class="calendar-grid" id="calendarGrid">
                <!-- Filled by JS -->
            </div>
        </section>

        <!-- Override Panel -->
        <section class="card override-card">
            <h2>Emergency Override</h2>
            <p class="muted">Immediately replace the active card on a board. The current card will be archived.</p>
            <form id="overrideForm">
                <div class="form-row">
                    <label for="overrideBoard">Board</label>
                    <select id="overrideBoard" required>
                        <option value="mainboard">Mainboard</option>
                        <option value="modboard">Modboard</option>
                    </select>
                </div>
                <div class="form-row">
                    <label for="overrideTemplate">Load from Template</label>
                    <select id="overrideTemplate">
                        <option value="">— Or paste HTML below —</option>
                    </select>
                </div>
                <div class="form-row">
                    <label for="overrideHtml">Replacement Card HTML</label>
                    <textarea id="overrideHtml" rows="5" placeholder="Paste override HTML…" required></textarea>
                </div>
                <div class="form-row">
                    <label for="overrideReason">Reason</label>
                    <input type="text" id="overrideReason" placeholder="e.g. Wrong card displayed">
                </div>
                <button type="submit" class="btn btn-danger">Apply Override</button>
            </form>
            <div id="overrideMessage" class="message hidden"></div>
        </section>

        <!-- Audit Log -->
        <section class="card audit-card">
            <h2>Audit Log</h2>
            <div class="audit-controls">
                <select id="auditFilter">
                    <option value="">All Actions</option>
                    <option value="schedule">Schedule Push</option>
                    <option value="edit">Edit</option>
                    <option value="delete">Delete</option>
                    <option value="override">Override</option>
                    <option value="swap">Midnight Swap</option>
                    <option value="fallback_triggered">Fallback Triggered</option>
                </select>
                <button class="btn btn-sm" id="refreshAudit">Refresh</button>
            </div>
            <div class="audit-list" id="auditList">
                <!-- Filled by JS -->
            </div>
        </section>
    </main>

    <!-- Card Preview Modal -->
    <div class="modal-overlay hidden" id="previewModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Card Preview</h3>
                <button class="btn btn-sm" id="closePreview">&times;</button>
            </div>
            <div class="modal-body">
                <iframe id="previewFrame" sandbox="allow-same-origin"></iframe>
            </div>
        </div>
    </div>

    <footer class="bottom-bar">
        <span>ATC TV Scheduler v2.0.0</span>
        <span>Next swap: <strong id="nextSwap">—</strong></span>
    </footer>

    <script src="/static/js/dashboard.js"></script>
</body>
</html>
